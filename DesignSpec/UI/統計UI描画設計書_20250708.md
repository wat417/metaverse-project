# 📘 統計UI描画設計書

作成日：2025-07-08  
作成者：Copilot  
対象：historyStatsView.ts, statusDisplay.ts, updateStatusText.ts  

---

## 1. 🎯 目的

履歴ログに基づき操作頻度・傾向を可視化し、ユーザーの行動パターンを把握・改善することを目的とする。  
可視化データを動的に生成・更新し、ユーザー体験とログ信頼性を高める。

---

## 2. 🧩 表示構成

| セクション | 表示内容                     | 備考                           |
|------------|------------------------------|--------------------------------|
| ヘッダ     | 「操作履歴グラフ」等         | セクションタイトル              |
| メイン領域 | 折れ線／棒グラフ（操作別）   | Canvas描画想定、日別集計軸     |
| サブ情報   | 件数表示、平均・中央値        | 件数閾値超過時のみ表示          |
| 状態出力   | データ未取得／対象外表示     | 「履歴データがありません」 等   |

---

## 3. 🚦 表示条件・制御仕様

| 条件                      | 処理動作                            |
|---------------------------|-------------------------------------|
| 有効履歴あり              | グラフ描画を実行（時系列集計）       |
| 履歴件数 0                | 「履歴データがありません」表示     |
| 異常データ（nullなど）    | エラー通知＋表示抑制                |
| 対象日数未満              | 幅不足警告等のラベルで補完           |

---

## 4. 🖌 描画仕様

- 使用想定：Chart.js または HTML5 Canvas API  
- 対象：日付 × 操作種別 件数  
- 色分け：操作種別別ラベルに対応  
- アニメーション：初回フェードイン、更新時スライドイン

---

## 5. ⚠️ フェイルセーフ条件

| 想定事象                    | 対応処理                                 |
|-----------------------------|------------------------------------------|
| IndexedDB通信失敗           | 「取得に失敗しました」ステータス表示     |
| ラベル不整合／分類不明      | Fallback文字列表示（statusMap参照）      |
| 描画エリア取得不可          | UI再描画イベントをemit                    |

---

## 6. ⛳ 接続ポイント

| 呼出元            | トリガ条件         | 備考                        |
|-------------------|--------------------|-----------------------------|
| MainScene.ts      | 起動完了時         | 初期ロード＋描画開始         |
| statusDisplay.ts  | 履歴更新時         | リフレッシュで再描画トリガ   |
| eventBus.ts       | 通知経由での即時反映 | 操作発生毎に更新可能性あり    |