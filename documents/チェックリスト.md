| ディレクトリ / ファイル名 .| 役割概要 .| 確認状況 | 備考 |
|---|---|---|---|
| index.html | SPAのHTMLエントリーポイント。Viteビルド時に`dist/index.html`へ展開される。 | 確認済 | |
| package.json | プロジェクト依存関係・スクリプト・メタ情報定義。Vite/Vue/Firebase等の依存を管理。 | 確認済 | |
| tsconfig.json | TypeScriptコンパイル設定。型解釈・パスエイリアス・strictモードなどを定義。 | 想定と異なる | `types` に `react` 系が含まれ、Vue構成と不整合。`module` も `CommonJS` で乖離。Vue構成に不要な型定義が混入しており、削除が必要。 |
| vercel.json | rewrites構成 `/chartTestPage`, `/mainTestPage` | 確認済 | SPAルーティングを包括的に成立させる構成。 |
| vite.config.ts | Viteのビルド・開発サーバー設定。エイリアス・プラグイン・出力構成を含む。 | 確認済 | vue-i18n対応含め、構成は期待通り。 |
| yarn.lock | `yarn`使用時の依存固定ファイル。 | 確認済 | `idb`, `long`, `protobufjs`, `cliui` などに重複バージョンが存在。`yarn-deduplicate` や `resolutions` による整理が必要。React型定義も混入しており、Vue構成に対しては明確な構成不整合。 |
| .github/workflows/deploy.yml | GitHub Pagesへの自動デプロイ構成。mainブランチへのpushをトリガーに、Node.js環境でViteビルド後、distを公開。 | 確認済 | `npm install -g vite` によるグローバルインストールは構成不整合。`package.json` に `vite` が含まれているため、ローカル依存でのビルドが正当。再現性の観点から削除推奨。 |
| dist/ | Viteビルド後の静的成果物配置ディレクトリ。Vercelにデプロイされる対象。 | － | － |
| dist/index.html | SPAエントリーポイント。Viteビルド後に生成され、`#app` にVueがマウントされる。 | 確認済 | `script` / `link` タグに含まれる `assets/*.js` / `*.css` はViteによるハッシュ付き成果物。構成として正常。タイトル・viewport・lang属性も適正。 || dist/assets/*.js, *.css           | JS/CSS成果物。Vueコンポーネント・ロジック・スタイルがバンドルされる。 | [ ] | |
| functions/chatFilter.ts | チャットメッセージのフィルタリングロジック。NGワード・ルール適用処理。 | 確認済 | `filterRules.json` の `enabled` ルールのみ適用。`RegExp(term, 'gi')` による多重一致・マスク処理は構成として妥当。`rulesConfig.mask` の存在チェックが省略されているため、空文字や未定義時の挙動に注意。 |
| functions/filterRules.ts | フィルタルール定義・適用処理。JSONルールの読み込みと適用。 | 確認済 | `rulesConfig.rules` の存在確認と `enabled` フィルタは妥当。`mask` のデフォルト値を `?? '***'` で明示しており、`chatFilter.ts` よりも構成的に安全。 |
| functions/filterText.ts | テキストベースのフィルタ処理。正規表現・文字列一致などを実装。 | 確認済 | `normalizeText` による NFKC 正規化と非文字・非数字除去は妥当。`filterText` は `getFilterRules` / `getMaskString` を使用し、構成的に安全。ただし `normalizeText` が `filterText` に未適用のため、フィルタ精度に差異が出る可能性あり。 |
| functions/index.ts | `functions/`配下のエントリーポイント。各フィルタ関数の統合・エクスポート。 | 確認済 | Firebase Functions の `onCall` による HTTPS callable 定義は妥当。`applyFilter` は `filterRules.ts` を介さず `rulesConfig` を直接参照しており、構成的に重複。フィルタロジックの一元化が望ましい。 |
| functions/config/filterRules.json | フィルタルール定義JSON。NGワード・カテゴリ・適用条件などを記述。 | 確認済 | `enabled: true` のルールのみ適用対象。`type` による分類は未使用。`mask: "※※※"` は明示されており、構成的に安全。ルールID・カテゴリ・語句の構造は妥当。 |
| src/ | アプリケーションのルート構成ディレクトリ。Vueコンポーネント・ロジック・設定群を統括。 | － | － |
| src/App.vue | ルートコンポーネント | 確認済 | `<router-view />` のみを描画する最小構成。`<script setup lang="ts">` による Composition API 構成は妥当。グローバルUIの追加余地あり。構成的に問題なし。 |
| src/auth.ts | Firebase認証関連の初期化・ログイン処理。GitHub認証障害の原因箇所の可能性あり。 | 確認済 | `onAuthStateChanged` による認証状態監視と `signInAnonymously` のフォールバックは妥当。`firebaseApp` の依存も整合。ログ出力は開発向けであり、本番環境では抑制推奨。 |
| src/firebaseConfig.ts | Firebase初期設定 | 確認済 | `import.meta.env.VITE_*` による環境変数の参照は Vite構成と整合。`initializeApp(firebaseConfig)` による初期化も妥当。構成的に問題なし。 |
| src/i18n.ts | 国際化設定 | 確認済 | `createI18n({ legacy: false })` による Composition API 対応構成は妥当。`notificationMessage.json` の読み込みも整合。`locale: "en"` 固定のため、動的切替が必要な場合は拡張要。 |
| src/main.ts | Vueインスタンス初期化 | 確認済 | `createApp(App).use(router).mount('#app')` による基本構成は妥当。`App.vue` / `router.ts` との依存関係も整合。構成的に問題なし。 |
| src/main_ui.ts | UI初期化処理 | 確認済 | Vueアプリケーションのエントリポイント。router-viewを含むApp.vueを基点に、i18nおよびrouterを適用して #app にマウント。構成的に明確かつ再現性あり。 |
| src/router.ts | UIルーティング構成 | 確認済 | Vue Router による SPAルーティング定義。開発用ページ群（dev/*）とUIページ（ui/chat/*）を明示的に分離。router-view による再現性確保済。createWebHistory により履歴管理も明示。 |
| src/vue-shim.d.ts | 型定義補完 | 確認済 | TypeScript における *.vue ファイルの型補完用 shim。DefineComponent により Vue SFC の型安全性を最低限確保。IDE補完・ビルド整合性の再現性に寄与。 |
| src/assets/ | アイコン・画像・i18nメッセージなどの静的リソース配置ディレクトリ。 | － | － |
| src/assets/chartIcons.ts | アイコン定義 | 確認済 | 各チャート種別に対応するSVG文字列を定義。再現性のある構成であり、getChartIcon による明示的取得関数も提供。UI描画における品質・構成責任を分離管理。 |
| src/assets/i18n/notificationMessage.json | 多言語通知メッセージ定義 | 確認済 | ja・en・zh の3言語に対応した通知文言を error / connection / status / chat に分類して定義。i18n構成の再現性・品質保証に寄与。キー構成も明示的で構成責任明確。 |
| src/chat/ | チャット処理ロジック群の配置ディレクトリ。フィルタ・履歴・統計処理を含む。 | － | － |
| src/chat/chartLabelMap.ts | チャート種別ラベル定義 | 確認済 | ja・en 対応のチャート種別ラベルと iconKey を定義。chartIcons.ts との照合性あり。UI表示とアイコン描画の構成責任を分離管理。再現性・品質観点ともに明確。 |
| src/chat/chatService.ts | チャット処理ロジック | 確認済 | `applyFilteredText` によるフィルタ適用と `notificationMessage.json` に基づく通知表示を構成。匿名ユーザーに対するフィルタ結果の分岐処理も妥当。UI通知は `showToast` に委譲されており、構成責任分離済。 |
| src/chat/eventClassifier.ts | チャットイベント分類ロジック | 確認済 | `ChatEvent` を `SYSTEM` / `ACTION` / `INFO` に分類し、`groupByType` により型別グルーピングを構成。判定条件は明確かつ網羅的で、初期値も型安全に定義済。 |
| src/chat/filterContext.ts | チャットテキストのフィルタ適用 | 確認済 | `getFilterRules` に基づき、匿名ユーザー条件付きでフィルタ語をマスク。`flagged` 判定・`matchedTerms` 記録・`masked` 出力が明確に分離され、再現性あり。`isNonViolationEvent` による違反有無判定も明快。 |
| src/chat/historyWriter.ts | チャット履歴のRTDB書き込み | 確認済 | `ChatEvent` の `timestamp` / `type` / `text` を Firebase RTDB の `history` ノードへ `push`。DB取得は `getRTDB` に委譲され、責務分離済。非同期処理も明確。 |
| src/chat/reportBuilder.ts | チャットイベントレポート生成 | 確認済 | `ChatEvent[]` を `filterEvents` → `groupByType` で整形し、`statistics` / `history` / `markdown` / `json` の各形式で出力。各フォーマット関数は責務分離され、再現性・構成明示性あり。 |
| src/chat/reportLogger.ts | チャットレポートの整形・ログ出力 | 確認済 | `ChatEvent[]` の `text` を `formatMessage` で整形し、`writeLog` により `chat_report` として記録。整形・出力の責務分離が明確で、再現性あり。 |
| src/chat/sessionTypes.ts | チャットセッション型定義 | 確認済 | `sessionId` / `userId` / `messages[]` を含む `ChatSessionData` 型を定義。`messages` は `content` / `timestamp` を持ち、構成責任が明確。 |
| src/chat/statisticsAggregator.ts | 統計集計ロジック | 確認済 | 任意配列 `data[]` から `type` 別集計・セッション数・メッセージ数・ユニークユーザー数を集計。`chartLabelMap` から日本語ラベルを取得し、`AggregatedStatistics` として構成。再現性・構成責任ともに明確。 |
| src/chat/statisticsTypes.ts | 統計構造型定義 | 確認済 | `AggregatedStatistics` 型として、合計セッション数・メッセージ数・アクティブユーザー数・チャートラベル・チャート種別・集計データを定義。構成責任が明確で再現性あり。 |
| src/components/ | UI部品群の配置ディレクトリ。チャート・通知・入力UIなどを含む。 | － | － |
| src/components/ChartDisplay.vue | チャート種別選択UI | 確認済 | `chartTypeList` に基づく `<select>` により種別選択を構成。選択変更は `onTypeChange` 経由で親へ通知。`chartIcon` は `getChartIcon` により動的取得され、構成責任分離済。 |
| src/components/ui/toastUI.vue        | トースト通知UI                               | [ ] | |
| src/config/ | 設定ファイル群の配置ディレクトリ。チャット・Firebase・公開設定などを含む。 | － | － |
| src/config/chatConfig.ts          | チャット関連設定                             | [ ] | |
| src/config/config.ts              | アプリ全体の共通設定。環境変数・定数などを定義。 | [ ] | |
| src/config/firebase.ts            | Firebase接続設定                             | [ ] | |
| src/config/publishConfig.ts       | 公開設定                                      | [ ] | |
| src/data/ | 静的データ定義群の配置ディレクトリ。チャート種別などを保持。 | － | － |
| src/data/chartTypeList.ts         | チャート種別一覧定義。UI選択肢や描画ロジックで使用。 | [ ] | |
| src/dev/ | テスト用UI群の配置ディレクトリ。機能検証・表示確認に使用。 | － | － |
| src/dev/chartSwitcher.vue         | チャート切替UI。複数チャートの表示切替を担う。 | [ ] | |
| src/dev/chartTestPage.vue         | チャート表示テストページ                     | [ ] | |
| src/dev/deployStatus.vue          | デプロイ状態表示                             | [ ] | |
| src/dev/logTester.vue             | ログ出力テストUI。`reportLogger.ts`や`outputLogger.ts`の検証に使用。 | [ ] | |
| src/dev/mainTestPage.vue          | メイン機能テストページ                       | [ ] | |
| src/dev/reportTester.vue          | レポート生成テストUI。`reportBuilder.ts`との連携確認に使用。 | [ ] | |
| src/dev/reportViewer.vue          | レポート表示UI。生成済みレポートの閲覧機能を提供。 | [ ] | |
| src/dev/statsChart.vue            | 統計チャート表示UI。`statisticsAggregator.ts`の出力を描画。 | [ ] | |
| src/dev/testLogger.vue            | ログ出力テスト                               | [ ] | |
| src/dev/testNotification.vue      | 通知表示テストUI。`toastUI.vue`や`getNotificationText.ts`の検証に使用。 | [ ] | |
| src/firebase/ | Firebase関連処理群の配置ディレクトリ。初期化・同期・書込・削除などを担う。 | － | － |
| src/firebase/init.ts              | Firebase初期化処理。SDKの設定と接続を担う。 | [ ] | |
| src/firebase/listen.ts            | FirebaseリアルタイムDBのリスナー設定。データ変更検知に使用。 | [ ] | |
| src/firebase/remove.ts            | Firebaseデータ削除処理。履歴・セッションの削除に使用。 | [ ] | |
| src/firebase/rtdbConfig.ts        | FirebaseリアルタイムDBの接続設定。URL・認証情報などを定義。 | [ ] | |
| src/firebase/sync.ts              | Firebaseとの同期処理。ローカルとクラウドのデータ整合性を担保。 | [ ] | |
| src/firebase/write.ts             | Firebaseへの書き込み処理。履歴・統計データの保存に使用。 | [ ] | |
| src/handlers/                     | メッセージ・イベント等のハンドラ群配置ディレクトリ。受信・分岐処理を担う。 | [ ] | |
| src/handlers/messageHandler.ts    | メッセージ受信・処理ハンドラ。チャット入力の受理と分岐処理。 | [ ] | |
| src/helpers/                      | 補助関数群の配置ディレクトリ。ストレージ・ユーティリティ処理を含む。 | [ ] | |
| src/helpers/storageHelper.ts      | ストレージ操作の補助関数群。localStorage等の抽象化。 | [ ] | |
| src/lib/                          | ライブラリ的構成要素の配置ディレクトリ。共通処理の統合管理。 | [ ] | |
| src/lib/storageManager.ts         | ストレージ管理ロジック。保存・取得・削除の統合処理。 | [ ] | |
| src/log/                          | ログ処理関連の構成ディレクトリ。イベント記録・出力制御を含む。 | [ ] | |
| src/log/genericEventLogger.ts     | 汎用イベントログ出力処理。記録・整形・出力を担う。 | [ ] | |
| src/log/rtdbAdapter.ts            | Firebaseログ出力用アダプタ。`genericEventLogger.ts`と連携。 | [ ] | |
| src/logs/                         | ログ出力成果物の配置ディレクトリ。外部出力・保存対象。 | [ ] | |
| src/logs/outputLogger.ts          | ログ出力処理。ファイル・コンソール・DB等への記録を担う。 | [ ] | |
| src/pages/                        | ページ単位のルーティング構成ディレクトリ。SPAルートと対応。 | [ ] | |
| src/pages/dev/chartTestPage.ts    | チャートテストページのロジック定義。UIと統計処理の連携を担う。 | [ ] | |
| src/pages/dev/chartTestPage.vue   | チャートテストページのUI定義。ルーティング対象。 | [ ] | |
| src/scenes/                          | メタバース風UIのシーン構成ディレクトリ。表示状態の管理を担う。 | [ ] | |
| src/scenes/MainScene.ts     | メインシーンの描画・状態管理ロジック。UIと内部状態の同期を担う。 | [ ] | |
| src/scenes/statusDisplay.ts            | ステータス表示シーンの描画ロジック。UIと状態の同期を担う。 | [ ] | |
| src/services/                          | サービスロジック群の配置ディレクトリ。UI通知・同期処理などを含む。 | [ ] | |
| src/services/peerAvatarSync.ts     | アバター同期処理。複数ユーザー間の状態共有に使用。 | [ ] | |
| src/services/toastService.ts            | トースト通知サービス。UIと通知文言の連携を担う。 | [ ] | |
| src/state/                          | 状態管理ストアの配置ディレクトリ。Pinia等による状態保持を担う。 | [ ] | |
| src/state/sessionStore.ts     | セッション状態の保持ストア。Pinia等で管理。 | [ ] | |
| src/stores/                          | 状態管理ストア群の配置ディレクトリ。チャット・統計等の状態保持。 | [ ] | |
| src/stores/chatStore.ts     | チャット状態の保持ストア。入力・履歴・フィルタ状態を管理。 | [ ] | |
| src/stores/statisticsStore.ts            | 統計データの状態管理ストア。集計結果の保持に使用。 | [ ] | |
| src/system/                          | システム制御ロジック群の配置ディレクトリ。ログ・監視制御などを含む。 | [ ] | |
| src/system/logManager.ts     | ログ管理ロジック。出力・保存・削除の統合制御。 | [ ] | |
| src/system/monitorStatus.ts            | モニタリング状態の管理。UI表示と内部状態の同期。 | [ ] | |
| src/tests/                          | テストコード群の配置ディレクトリ。機能検証・出力確認に使用。 | [ ] | |
| src/tests/reportOutputTest.ts     | レポート出力のテストコード。`reportBuilder.ts`との整合性検証。 | [ ] | |
| src/tests/                          | テストコード群の配置ディレクトリ（重複記載）。 | [ ] | |
| src/types/i18nTypes.ts     | 国際化関連の型定義。メッセージ構造・言語設定の型補完。 | [ ] | |
| src/types/json.d.ts     | JSON型定義。静的型補完用。 | [ ] | |
| src/types/message.ts     | メッセージ構造の型定義。チャット処理との整合性を担保。 | [ ] | |
| src/types/player.ts     | プレイヤー構造の型定義。アバター・状態管理に使用。 | [ ] | |
| src/ui/                          | UI描画ロジック群の配置ディレクトリ。表示制御・状態同期を担う。 | [ ] | |
| src/ui/chartUIConnector.ts     | チャートUIとの接続ロジック。データとUIの橋渡しを担う。 | [ ] | |
| src/ui/displayAbstraction.ts     | UI表示の抽象化ロジック。複数UI構成の統合制御。 | [ ] | |
| src/ui/finalizeDisplay.ts     | UI表示の最終調整処理。 | [ ] | |
| src/ui/groupControl.ts     | グループ表示制御ロジック。複数プレイヤーのUI同期を担う。 | [ ] | |
| src/ui/historyStatusView.ts     | 履歴ステータス表示UI。過去状態の可視化を担う。 | [ ] | |
| src/ui/statusDisplay.ts     | ステータス表示UI。現在状態の可視化を担う。 | [ ] | |
| src/ui/statusRenderer.ts     | ステータス描画ロジック。状態に応じたUI更新を担う。 | [ ] | |
| src/ui/teamSelector.ts     | チーム選択UI。プレイヤーの所属選択を担う。 | [ ] | |
| src/ui/updateStatusText.ts     | ステータステキスト更新処理。状態変化に応じた文言制御。 | [ ] | |
| src/ui/chat/chatInput.vue     | チャット入力UI。ユーザー入力の受理と送信を担う。 | [ ] | |
| src/ui/chat/chatUI.vue     | チャット表示UI。メッセージの描画と通知を担う。 | [ ] | |
| src/utils/                        | 汎用処理群の配置ディレクトリ。チャート・通知・差分処理などを含む。 | [ ] | |
| src/utils/botRegistry.ts     | ボット定義の登録処理。応答ロジックとの連携を担う。 | [ ] | |
| src/utils/botReplyHelper.ts     | ボット応答補助処理。メッセージ生成・整形を担う。 | [ ] | |
| src/utils/chartRenderer.ts        | チャート描画ロジック。統計データの可視化を担う。 | [ ] | |
| src/utils/eventBus.ts             | イベント伝播処理 | [ ] | |
| src/utils/formatMessage.ts     | メッセージ整形処理。通知・チャット表示用の文言調整を担う。 | [ ] | |
| src/utils/generateDiff.ts         | 差分生成処理。前回状態との比較結果を出力。 | [ ] | |
| src/utils/getNotificationText.ts     | 通知文言生成処理。状態やイベントに応じたメッセージを生成。 | [ ] | |
| src/utils/importHelper.ts     | 動的インポート補助処理。モジュールの遅延読み込みを担う。 | [ ] | |
| src/utils/nameEmojiMap.ts     | 名前と絵文字のマッピング定義。UI表示の視覚補助に使用。 | [ ] | |
| src/utils/nameEmojiMapper.ts     | 名前と絵文字の変換処理。`nameEmojiMap.ts`と連携。 | [ ] | |
| src/utils/playerMap.ts     | プレイヤーIDと表示名のマッピング定義。状態表示に使用。 | [ ] | |
| src/utils/playerStateTracker.ts     | プレイヤー状態の追跡処理。変化検知と履歴記録を担う。 | [ ] | |
| src/utils/statusMap.ts     | 状態コードと表示文言のマッピング定義。UI描画に使用。 | [ ] | |
| src/utils/storageHelper.ts     | ストレージ操作の補助関数群。localStorage等の抽象化。 | [ ] | |