# ğŸ“… æ—¥æ¬¡ä½œæ¥­è¨˜éŒ²ï¼ˆ2025/07/06ï¼‰

---

## âœ… æœ¬æ—¥ã®ä½œæ¥­ãƒ­ã‚°

| ã‚¹ãƒ†ãƒƒãƒ— | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« |
|---------|------|--------------|
| Step16-a | å·®åˆ†æ¤œçŸ¥æ§‹é€ ã®æ•´å‚™ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‹å·®åˆ†é–¢æ•°ï¼‰ | `playerMap.ts` |
| Step16-b | ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ–°è¦ä½œæˆ | `eventBus.ts` |
| Step16-c | RTDBå¤‰æ›´æ¤œçŸ¥ â†’ å·®åˆ†åˆ¤å®š â†’ ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ã®æ§‹é€ å®Ÿè£… | `sync.ts`ï¼ˆ`listenPlayerData()`è¿½åŠ ï¼‰ |
| Step16-d | è¡¨ç¤ºæ›´æ–°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç–çµåˆæ§‹ç¯‰ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ â†’ UIåæ˜ ï¼‰ | `statusDisplay.ts`ï¼ˆæ–°è¦ä½œæˆï¼‰ |
| Step16-e | è¡¨ç¤ºç”Ÿæˆè²¬å‹™ã®å¤–éƒ¨å§”è­²ãƒ»ä¾å­˜æ’é™¤ï¼ˆMainSceneå†æ§‹æˆï¼‰ | `MainScene.ts`ï¼ˆè¨­è¨ˆæ§‹æˆæç¤ºï¼‰ |
| Step16-e-A | è¡¨ç¤ºæ§‹é€ ä¿®æ­£ã®å®Ÿè£…åæ˜ ï¼ˆstatusDisplay.tsã®å°å…¥ï¼‰ | `MainScene.ts`ï¼ˆä¿®æ­£å®Œäº†ï¼‰ |
| Step17-a | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ›´æ–°ã®ç²¾åº¦å‘ä¸Šï¼ˆå·®åˆ†æŠ½è±¡åŒ–ï¼‰ | `statusMap.ts`, `statusDisplay.ts` |
| Step17-b-S | name / emoji ã®éåŒæœŸåˆ¶å¾¡æ§‹é€ ã®è¨­è¨ˆæç¤º | `nameEmojiMap.ts`, `statusDisplay.ts` |
| Step17-c-S | RTDBä¸€æ‹¬å–å¾—æ§‹é€ ã¨è¡¨ç¤ºåæ˜ ã®è¨­è¨ˆæç¤º | `playerStateTracker.ts`, `sync.ts`, `statusDisplay.ts` |
| Step17-c-I | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ã®ä¸€æ‹¬åŒæœŸå®Ÿè£…ï¼ˆå–å¾— â†’ å·®åˆ†é€šçŸ¥ â†’ è¡¨ç¤ºåæ˜ ï¼‰ | `playerStateTracker.ts`, `sync.ts`, `statusDisplay.ts` |
| Step17-b-I-Resolve | è¡¨ç¤ºæ§‹é€ ã®æ•´åˆä¸å‚™ä¿®æ­£ï¼ˆcreateStatusLabel å¼•æ•°ä¿®æ­£ / syncPlayerPosition ä»•æ§˜å¾©å…ƒï¼‰ | `MainScene.ts`, `statusDisplay.ts`, `sync.ts` |
| Step18 | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’å‹•çš„ãƒ©ãƒ™ãƒ«ä¸€è¦§æ§‹é€ ã«ç§»è¡Œï¼ˆDOMã‚³ãƒ³ãƒ†ãƒŠï¼‹å­˜åœ¨ç¢ºèªå‹æ›´æ–°ï¼‰ | `statusDisplay.ts` |
| Step19-a | ãƒ©ãƒ™ãƒ«èƒŒæ™¯è‰²ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«å‹•çš„åˆ¶å¾¡ï¼ˆè¡¨ç¤ºçŠ¶æ…‹ã®è¦–èªæ€§å‘ä¸Šï¼‰ | `statusDisplay.ts` |
| Step19-b | Zé †ã«ã‚ˆã‚‹ãƒ©ãƒ™ãƒ«è¡¨ç¤ºéšå±¤åˆ¶å¾¡ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã®è¦–è¦šå„ªå…ˆï¼‰ | `statusDisplay.ts` |
| Step20-a | ãƒãƒ¼ãƒ åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ãƒ©ãƒ™ãƒ«è¡¨ç¤ºåˆ¶å¾¡ã®å°å…¥ | `statusDisplay.ts` |
| Step20-b | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—è¡¨ç¤ºã®å°å…¥ï¼ˆDOMé †åºã«ã‚ˆã‚‹æ•´åˆ—ï¼‹å‹å®‰å…¨å¯¾å¿œï¼‰ | `statusDisplay.ts` |

---

## ğŸ›  ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆä½œæ¥­ç€æ‰‹é †ï¼‰

1. `src/utils/playerStateTracker.ts`ï¼ˆæ–°è¦ï¼‰  
â€ƒâ€ƒè¿½åŠ ï¼š`playerStateCache`, `getDiffs()` ã«ã‚ˆã‚‹å·®åˆ†æ¤œçŸ¥æ§‹é€ 

2. `src/firebase/sync.ts`  
â€ƒâ€ƒè¿½åŠ ï¼š`syncAllPlayerStates()` ã«ã‚ˆã‚‹ RTDB ä¸€æ‹¬å–å¾—å‡¦ç†  
â€ƒâ€ƒâ€ƒâ€ƒâ€ƒå·®åˆ†æŠ½å‡º â†’ `"playerBatchUpdate"` é€šçŸ¥ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«  
â€ƒâ€ƒâ€ƒâ€ƒâ€ƒä¿®æ­£ï¼š`syncPlayerPosition(uid: string, x: number, y: number)` ã«ä»•æ§˜å¾©å…ƒ

3. `src/scenes/statusDisplay.ts`  
â€ƒâ€ƒè¿½åŠ ï¼š`STATUS_COLORS` / `STATUS_Z_INDEX` / `groupedLabels` / `activeTeamFilter`  
â€ƒâ€ƒâ€ƒâ€ƒâ€ƒ`applyStatusStyle()` / `insertGroupedLabel()` ã«ã‚ˆã‚‹æ•´åˆ—ã¨ã‚¹ã‚¿ã‚¤ãƒ«åæ˜   
â€ƒâ€ƒâ€ƒâ€ƒâ€ƒ`updateStatusLabel()` ã« nullåˆ¤å®šã¨å‹å®‰å…¨æ§‹é€ çµ±åˆ  
â€ƒâ€ƒâ€ƒâ€ƒâ€ƒ`labelNode â†’ label` ã®å†å®£è¨€æ–¹å¼ã«ã‚ˆã‚‹å‹ã‚¨ãƒ©ãƒ¼å›é¿  
â€ƒâ€ƒâ€ƒâ€ƒâ€ƒ`setTeamFilter()` ã«ã‚ˆã‚‹å¤–éƒ¨åˆ¶å¾¡å¯¾å¿œ  
â€ƒâ€ƒä¿®æ­£ï¼šå·®åˆ†ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç† â†’ `team` / `status` æƒ…å ±çµ±åˆå¯¾å¿œæ¸ˆ

4. `src/scenes/MainScene.ts`  
â€ƒâ€ƒä¿®æ­£ï¼šè¡¨ç¤ºãƒ©ãƒ™ãƒ«åˆæœŸç”Ÿæˆã‚’æ’é™¤ï¼ˆè²¬å‹™ç§»è­²æ¸ˆï¼‰  
â€ƒâ€ƒâ€ƒâ€ƒâ€ƒå·®åˆ†æ›´æ–°æ–¹å¼ã®çµ±åˆé€£æºç¶­æŒ

---

## ğŸ¯ æ¬¡å›ä½œæ¥­äºˆå®š

- Step21-aï¼šhoveræ™‚ã®ãƒ©ãƒ™ãƒ«å¼·èª¿åˆ¶å¾¡ï¼ˆUIè¦–èªæ€§å¼·åŒ–ï¼‰  
- Step21-bï¼šãƒ©ãƒ™ãƒ«ã‚¯ãƒªãƒƒã‚¯æ™‚ã®è©³ç´°æƒ…å ±å±•é–‹æ§‹é€ ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«é€£æºï¼‰

---

## ğŸ”’ é‹ç”¨ç•™æ„äº‹é …ï¼ˆè‡ªå‹•è£œå®Œï¼‰

- `updateStatusLabel()` ã«ãŠã‘ã‚‹ nullå¯¾å‡¦å‹æ§‹æˆã«ã‚ˆã‚Šã€TypeScriptã‚¨ãƒ©ãƒ¼ã¯è§£æ¶ˆæ¸ˆ  
- ã‚°ãƒ«ãƒ¼ãƒ—è¡¨ç¤ºï¼DOMé †åºåˆ¶å¾¡ã¯ status æƒ…å ±ã«åŸºã¥ã„ã¦ä¸€è²«ã—ãŸæ§‹é€ ã§æ•´å‚™æ¸ˆ  
- è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ«ã¨ãƒ©ãƒ™ãƒ«ã®è²¬å‹™åˆ†é›¢ã¯ä»Šå¾Œã®UIæ“ä½œå°å…¥ã«å¯¾å¿œå¯èƒ½ãªçŠ¶æ…‹ã‚’ç¶­æŒ